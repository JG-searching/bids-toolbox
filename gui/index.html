<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="brain_logo_q1Z_icon.ico">

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>The BIDS Toolbox</title>

    <!-- Bootstrap core CSS -->
    <link href="https://getbootstrap.com/docs/4.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="template.css" rel="stylesheet">

  </head>

  <body>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>

<!--Control to select folder instead of file from:  https://stackoverflow.com/questions/12942436/how-to-get-folder-directory-from-html-input-type-file-or-any-other-way -->
<!-- Dynamic table from: https://bootsnipp.com/snippets/402bQ -->

	<script>

	$(document).ready(function () {

	    $("#createForm").hide();
	    $("#updateForm").hide();

	    $('input[type="radio"]').click(function(){
		var inputValue = $(this).attr("value");

		if (inputValue == "create")
		{
	    		$("#updateForm").hide();
			$("#createForm").show();
		}
		else
		{
			$("#createForm").hide();
	    		$("#updateForm").show();
		}
	    });

	    var scan_counter = 0; //Number of rows in the createDataset, scan-types table
	    var desc_c_counter = 0; //Number of rows in the createDataset, dataset-description table
	    var desc_u_counter = 0; //Number of rows in the createDataset, dataset-description table

	    $("#scan_addrow").on("click", function () {
		var newRow = $("<tr>");
		var cols = "";

		cols += '<td><input type="text" class="form-control" name="scan_name' + scan_counter + '"/></td>';
		cols += '<td> <select id="scan_type' + scan_counter + '" class="form-control"> <option selected>func</option> <option>dwi</option> <option>fmap</option> <option>anat</option> <option>meg</option> </select> </td>';
		cols += '<td><input type="text" class="form-control" name="scan_type' + scan_counter + '"/></td>';

		cols += '<td><input type="button" class="ibtnDel btn btn-md btn-danger "  value="Delete"></td>';
		newRow.append(cols);
		$("#scan_types_table").append(newRow);
		scan_counter++;
	    });

	    $("#scan_types_table").on("click", ".ibtnDel", function (event) {
		$(this).closest("tr").remove();       
		scan_counter -= 1
	    });

	    $("#desc_create_addrow").on("click", function () {
		var newRow = $("<tr>");
		var cols = "";

		cols += '<td><input type="text" class="input-sm form-control" name="desc_key' + desc_c_counter + '"/></td>';
		cols += '<td><input type="text" class="input-sm form-control" name="desc_value' + desc_c_counter + '"/></td>';

		cols += '<td><input type="button" class="ibtnDel btn btn-md btn-danger "  value="Delete"></td>';
		newRow.append(cols);
		$("#desc_create_table").append(newRow);
		desc_c_counter++;
	    });

	    $("#desc_create_table").on("click", ".ibtnDel", function (event) {
		$(this).closest("tr").remove();       
		desc_c_counter -= 1
	    });

	    $("#desc_update_addrow").on("click", function () {
		var newRow = $("<tr>");
		var cols = "";

		cols += '<td><input type="text" class="input-sm form-control" name="desc_key' + desc_u_counter + '"/></td>';
		cols += '<td><input type="text" class="input-sm form-control" name="desc_value' + desc_u_counter + '"/></td>';

		cols += '<td><input type="button" class="ibtnDel btn btn-md btn-danger "  value="Delete"></td>';
		newRow.append(cols);
		$("#desc_update_table").append(newRow);
		desc_u_counter++;
	    });

	    $("#desc_update_table").on("click", ".ibtnDel", function (event) {
		$(this).closest("tr").remove();       
		desc_u_counter -= 1
	    });

	});

	function calculateRow(row) {
	    var price = +row.find('input[name^="price"]').val();
	}

	function calculateGrandTotal() {
	    var grandTotal = 0;
	    $("table.order-list").find('input[name^="price"]').each(function () {
		grandTotal += +$(this).val();
	    });
	    $("#grandtotal").text(grandTotal.toFixed(2));
	}
	</script>

    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top"> 
      <a class="navbar-brand" href="https://www.cardiff.ac.uk/cardiff-university-brain-research-imaging-centre">Cardiff University Brain Research Imaging Centre (CUBRIC)</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
      </button>
    </nav>

    <main role="main" class="container">

      <div class="starter-template">
    	<img src="brain_logo.png" class="img-rounded" alt="Brain logo here" height="60" width="60" > 
        <h1>The BIDS Toolbox</h1>
        <p class="lead">
	 Use this tool to create and manage Brain Imaging Data Structure (BIDS) datasets.<br>
	 Choose between the options below to start. Learn more about BIDS <a href="http://bids.neuroimaging.io">here</a>. 
	</p>

	I want to:
	<div class="form-check form-check-inline">
	  <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="create">
	  <label class="form-check-label" for="inlineRadio1">create a new dataset</label>
	</div>
	<div class="form-check form-check-inline">
	  <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="update">
	  <label class="form-check-label" for="inlineRadio2">update an existing dataset</label>
	</div>

      </div>

	<form id="createForm">
	A BIDS dataset is created from a set of DICOM files and some additional descriptive metadata. Follow the steps below to provide the required information for the creation of your dataset.<br><br>

	  <div class="form-group">
	    <label for="exampleFormControlFile1"><b>First:</b> Select the folder that contains the raw DICOM files. This step is <u>obligatory</u>: </label>
	    <input type="file" id="dicom_folder" webkitdirectory directory multiple/>
	  </div>

	  <div class="form-group">
	    <label for="exampleFormControlFile1"><b>Second:</b> Select the output folder to store the BIDS dataset. This step is <u>obligatory</u>:  </label>
	    <input type="file" id="output_folder" webkitdirectory directory multiple/>
	  </div>

	<b>Third:</b> BIDS datasets include a mandatory <i>dataset_description.json</i> file which describe their content. This file is arrange in key-value pairs and you should add in the following table those that you want added to your dataset. This step is <u>optional</u>.<br><br>

	<div class="container">
	    <table id="desc_create_table" class=" table order-list">
	    <thead>
		<tr>
		    <td>Key</td>
		    <td>Value</td>
		</tr>
	    </thead>
	    <tbody>
		<tr>
		    <td>
			<input type="text" name="desc_key" class="input-sm form-control" />
		    </td>
		    <td>
			<input type="text" name="desc_value"  class="input-sm form-control"/>
		    </td>
		    <td><a class="deleteRow"></a>

		    </td>
		</tr>
	    </tbody>
	    <tfoot>
		<tr>
		    <td colspan="5" style="text-align: left;">
			<input type="button" class="btn btn-lg btn-block " id="desc_create_addrow" value="Add Row" />
		    </td>
		</tr>
		<tr>
		</tr>
	    </tfoot>
	</table>
	</div>

	<b>Fourth:</b> During the creation of the BIDS dataset, the Toolbox will create a set of Nifti files based on the DICOM files you provide. However, the DICOM files don't declare explicitly the type of acquisition (whether the scan is structural, diffusion,... ) and knowing so is mandatory for the creation of the dataset. The Toolbox includes a heuristic to infer the type of scan based on several parameters of the DICOM headers, but it is not 100% accurate. If you know these values, you can define the type of scan for each of the series in the following fields. This step is <u>optional</u>.<br><br>

	<div class="container">
	    <table id="scan_types_table" class=" table order-list">
	    <thead>
		<tr>
		    <td>Name</td>
		    <td>Scan type</td>
		    <td>Scan modality</td>
		</tr>
	    </thead>
	    <tbody>
		<tr>
		    <td>
			<input type="text" name="scan_name" class="input-sm form-control" />
		    </td>
		    <td>
		      <select id="scan_type" class="form-control">
			<option selected>func</option>
			<option>dwi</option>
			<option>fmap</option>
			<option>anat</option>
			<option>meg</option>
		      </select>
		    </td>
		    <td>
			<input type="text" name="scan_type"  class="input-sm form-control"/>
		    </td>
		    <td><a class="deleteRow"></a>

		    </td>
		</tr>
	    </tbody>
	    <tfoot>
		<tr>
		    <td colspan="5" style="text-align: left;">
			<input type="button" class="btn btn-lg btn-block " id="scan_addrow" value="Add Row" />
		    </td>
		</tr>
		<tr>
		</tr>
	    </tfoot>
	</table>
	</div>

	And that's it. Check that all the values you've entered look good and click the button below to start. <br><br>

	  <button type="submit" class="btn btn-primary">Create dataset</button>
	</form>


	<form id="updateForm">
	This section is used to append brain imaging files to an existing BIDS dataset created with this toolbox. Follow the steps below to provide the required information: <br><br>	

	  <div class="form-group">
	    <label for="exampleFormControlFile1"><b>First:</b> Select the folder of the BIDS dataset to be updated. This step is <u>obligatory</u>:  </label>
	    <input type="file" id="output_folder" webkitdirectory directory multiple/>
	  </div>

	  <div class="form-group">
	    <label for="exampleFormControlFile1"><b>Second:</b> Select the folder that contains the new DICOM files. This step is <u>obligatory</u>: </label>
	    <input type="file" id="dicom_folder" webkitdirectory directory multiple/>
	  </div>

	<b>Third:</b> Use the following table to append/modify key-value pairs to the <i>dataset_description.json</i> file of the dataset. This step is <u>optional</u>.<br><br>

	<div class="container">
	    <table id="desc_update_table" class=" table order-list">
	    <thead>
		<tr>
		    <td>Key</td>
		    <td>Value</td>
		</tr>
	    </thead>
	    <tbody>
		<tr>
		    <td>
			<input type="text" name="desc_key" class="input-sm form-control" />
		    </td>
		    <td>
			<input type="text" name="desc_value"  class="input-sm form-control"/>
		    </td>
		    <td><a class="deleteRow"></a>

		    </td>
		</tr>
	    </tbody>
	    <tfoot>
		<tr>
		    <td colspan="5" style="text-align: left;">
			<input type="button" class="btn btn-lg btn-block " id="desc_update_addrow" value="Add Row" />
		    </td>
		</tr>
		<tr>
		</tr>
	    </tfoot>
	</table>
	</div>

	That's it. Check that all the values you've entered look good and click the button below to update your dataset. <br><br>

	  <button type="submit" class="btn btn-primary">Update dataset</button>

	</form>	

	<br><br>
	<small>
	The BIDS Toolbox is part of the <i>Microstructural Imaging Data Centre (MIDaC)</i> project, grant reference ST/S00209X/1, funded by the Science and Technology Facilities Council (STFC) of the UK.  
	</small>
	<br><br>

    </main><!-- /.container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://getbootstrap.com/docs/4.0/assets/js/vendor/popper.min.js"></script>
    <script src="https://getbootstrap.com/docs/4.0/dist/js/bootstrap.min.js"></script>
  </body>
</html>

